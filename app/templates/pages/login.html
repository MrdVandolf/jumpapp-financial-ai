{% extends "index.html" %}

{% block title %}Login{% endblock %}

{% block additional_style %}
<link rel="stylesheet" href="{{ url_for('static', path='/css/login.css') }}">
{% endblock %}

{% block content %}
<div class="main_container container">
    <form action="/auth" method="post" id="loginForm">
        <div class="container">
            <label><b>Email</b></label>
            <input type="email" placeholder="Enter email" name="email" required>

            <label><b>Password</b></label>
            <input type="password" placeholder="Enter Password" name="password" required>

            <span class="warning" id="warning"></span>

            <button type="submit">Login</button>
          </div>

    </form>
    <div class="container">
        <button onclick="window.location.href = '/auth/google/in';">Login with Google</button>
    </div>

</div>

<script>
    const form = document.getElementById("loginForm");

    form.addEventListener("submit", async function(event) {
      event.preventDefault();
      const formData = new FormData(form);
      const data = Object.fromEntries(formData.entries());
      const response = await fetch(form.action, {
        method: form.method,
        headers: {
            "Content-Type": "application/json"
        },
        body: JSON.stringify(data),
      });

      const warning = document.getElementById("warning");
      warning.textContent = "";
      if (response.status == 200) {
        window.location.href = "/";
      } else if (response.status == 404) {
        warning.textContent = "No user is registered under this email";
      } else if (response.status == 401) {
        warning.textContent = "Wrong email or password";
      } else {
        warning.textContent = `Error: ${result}`;
      }
    });
</script>
{% endblock %}