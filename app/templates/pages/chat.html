{% extends "index.html" %}
{% from "widgets/chat.html" import chat_list, display_current_chat with context %}

{% block title %}Main{% endblock %}
{% block additional_style %}
<link rel="stylesheet" href="{{ url_for('static', path='/css/chat.css') }}">
{% endblock %}

{% block content %}
<div class="container">

    <div class="sidebar">
        <button onclick="newChat()">New chat</button>

        {{ chat_list(chats) }}
          <!-- bottom -->
        <button id="logout-btn">Exit</button>
    </div>

    <div class="chat">
        {{ display_current_chat(current_chat) }}

        <div class="input-area">
            <input type="text" placeholder="Ask me something...">
            <button>Send</button>
        </div>
    </div>
</div>

<script>
  function newChat() {
      window.location.href = "/";
  };

  document.getElementById("logout-btn").addEventListener("click", async () => {
  try {
    const response = await fetch("/logout", {
      method: "POST",
      headers: {
        "Content-Type": "application/json"
      },
    });

    if (response.ok) {
      window.location.reload();
    } else {
      const errorText = await response.text();
      alert("Error: " + errorText);
    }
  } catch (err) {
    alert("Connection error: " + err.message);
  }
});
</script>
{% endblock %}